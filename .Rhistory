filter(gwno == 101) %>%
#mutate(pop_cut = cut_number(pop_gpw_sum, 10)) %>%
ggplot(aes(fill = pop_gpw_sum)) +
geom_sf() +
theme_minimal() +
scale_fill_viridis_c(option = "inferno", end = .9, trans = "log10", "Logged Population") +
labs(title = "GRID-level population in Venezuela")
# plot Venezuela as sanity check
prio %>%
filter(gwno == 101) %>%
#mutate(pop_cut = cut_number(pop_gpw_sum, 10)) %>%
ggplot(aes(fill = pop_gpw_sum)) +
geom_sf() +
theme_minimal() +
scale_fill_viridis_c(option = "inferno", end = .9, trans = "log10", name = "Logged Population") +
labs(title = "GRID-level population in Venezuela")
# plot Venezuela as sanity check
prio %>%
filter(gwno == 101) %>%
#mutate(pop_cut = cut_number(pop_gpw_sum, 10)) %>%
ggplot(aes(fill = pop_gpw_sum)) +
geom_sf() +
theme_minimal() +
scale_fill_viridis_c(option = "inferno",
end = .9,
trans = "log10",
labels = scales::comma) +
labs(title = "GRID-level population in Venezuela")
# plot Venezuela as sanity check
prio %>%
filter(gwno == 101) %>%
#mutate(pop_cut = cut_number(pop_gpw_sum, 10)) %>%
ggplot(aes(fill = pop_gpw_sum)) +
geom_sf() +
theme_minimal() +
scale_fill_viridis_c(option = "inferno",
end = .9,
trans = "log10",
labels = scales::comma,
name = "") +
labs(title = "GRID-level population in Venezuela")
# convert back to sp object to use nice sp dep functions
earth_sp = as(earth, Class = "Spatial")
# get neighbors
nb = poly2nb(earth_sp,
queen = FALSE,
row.names = earth$gid)
# convert back to sp object to use nice sp dep functions
prio_land_sp = as(prio_land, Class = "Spatial")
# get neighbors
nb = poly2nb(prio_land_sp,
queen = FALSE,
row.names = prio_land_sp$gid)
knitr::opts_chunk$set(echo = TRUE, warning = F,message = F)
library(tidyverse)
library(sf)
library(spdep)
library(rgdal)
library(vroom)
# read data
prio = st_read(dsn = "/Users/JuamnTellez/Dropbox/papers/State Origins and Violence/Data/priogrid_cellshp",
layer = "priogrid_cell",
stringsAsFactors = F) %>%
mutate(gid = as.character(gid))
prio %>%
head()
# read in PRIO yearly data
prio_year =
# just want gid and gwno to identify water
vroom("/Users/JuamnTellez/Dropbox/papers/State Origins and Violence/Data/prio-grid-2/prio-grid-yearly.csv",
col_select = c("gid", "gwno", "year", "pop_gpw_sum")) %>%
# we got multipe years of data and changing country,
# so i'm arbitrarily picking all countries in most recent year
filter(year == 2005) %>%
mutate(gid = as.character(gid)) %>%
select(-year)
# merge in gwno to identify country grids
prio = left_join(prio, prio_year)
head(prio)
# plot Venezuela as sanity check
prio %>%
filter(gwno == 101) %>%
#mutate(pop_cut = cut_number(pop_gpw_sum, 10)) %>%
ggplot(aes(fill = pop_gpw_sum)) +
geom_sf() +
theme_minimal() +
scale_fill_viridis_c(option = "inferno",
end = .9,
trans = "log10",
labels = scales::comma,
name = "") +
labs(title = "GRID-level population in Venezuela")
## throw out water tiles: places with no gwno == not countries
prio_land =
prio %>%
drop_na(gwno)
# convert back to sp object to use nice sp dep functions
prio_land_sp = as(prio_land, Class = "Spatial")
# get neighbors
nb = poly2nb(prio_land_sp,
queen = FALSE,
row.names = prio_land_sp$gid)
nb
nb
# let's do this again, but with sf package; faster, but seems dodgier, based off a github comment:
# https://github.com/r-spatial/sf/issues/234
st_rook = function(a, b = a) st_relate(a, b, pattern = "F***1****")
prio_land = prio_land %>% mutate(NB_ROOK = st_rook(.))
lw = nb2listw(nb, style = "W", zero.policy = TRUE)
print(lw, zero.policy = TRUE)
?poly2nb
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() + geom_sf() +
geom_sf(data = filter(prio_land, gid == 211700), fill = "red")
# plot place with no neighbors, Alaskan island
prio_land_sp %>%
filter(gwno == 2) %>%
ggplot() + geom_sf() +
geom_sf(data = filter(prio_land_sp, gid == 211700), fill = "red")
prio_land_sp %>%
filter(gwno == 2)
prio_land %>%
filter(gwno == 2)
## throw out water tiles: places with no gwno == not countries
prio_land =
prio %>%
drop_na(gwno)
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() + geom_sf() +
geom_sf(data = filter(prio_land_sp, gid == 211700), fill = "red")
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() + geom_sf() +
geom_sf(data = filter(prio_land, gid == 211700), fill = "red")
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() +
geom_sf() +
# add the place with no neighbors
geom_sf(data = filter(prio_land, gid == 211700), fill = "red") +
xlim(c(170, 160))
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() +
geom_sf() +
# add the place with no neighbors
geom_sf(data = filter(prio_land, gid == 211700), fill = "red") +
xlim(c(170, 160)) +
ylim(c(50, 70))
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() +
geom_sf() +
# add the place with no neighbors
geom_sf(data = filter(prio_land, gid == 211700), fill = "red") +
coord_quickmap(xlim = c(170, 160),
ylim = c(50, 70))
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() +
geom_sf() +
# add the place with no neighbors
geom_sf(data = filter(prio_land, gid == 211700), fill = "red") +
coord_sf(xlim = c(170, 160),
ylim = c(50, 70))
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() +
geom_sf() +
# add the place with no neighbors
geom_sf(data = filter(prio_land, gid == 211700), fill = "red") +
coord_sf(xlim = c(170, 160),
ylim = c(50, 70), expand = F)
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() +
geom_sf() +
# add the place with no neighbors
geom_sf(data = filter(prio_land, gid == 211700), fill = "red") +
coord_sf(xlim = c(-88, -78), ylim = c(24.5, 33), expand = FALSE)
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() +
geom_sf() +
# add the place with no neighbors
geom_sf(data = filter(prio_land, gid == 211700), fill = "red") +
coord_sf(xlim = c(160, 170), ylim = c(50, 70), expand = FALSE)
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() +
geom_sf() +
# add the place with no neighbors
geom_sf(data = filter(prio_land, gid == 211700), fill = "red") +
coord_sf(xlim = c(160, 170), ylim = c(50, 70))
prio_land %>%
filter(gwno == 2) %>%
ggplot() +
geom_sf() +
# add the place with no neighbors
geom_sf(data = filter(prio_land, gid == 211700), fill = "red")
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() +
geom_sf() +
# add the place with no neighbors
geom_sf(data = filter(prio_land, gid == 211700), fill = "red") +
coord_sf(xlim = c(160, 170), expand = FALSE)
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() +
geom_sf() +
# add the place with no neighbors
geom_sf(data = filter(prio_land, gid == 211700), fill = "red") +
coord_sf(xlim = c(160, 170), expand = TRUE)
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() +
geom_sf() +
# add the place with no neighbors
geom_sf(data = filter(prio_land, gid == 211700), fill = "red") +
coord_sf(xlim = c(-170, -160), expand = FALSE)
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() +
geom_sf() +
# add the place with no neighbors
geom_sf(data = filter(prio_land, gid == 211700), fill = "red") +
coord_sf(xlim = c(-170, -140), expand = FALSE)
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() +
geom_sf() +
# add the place with no neighbors
geom_sf(data = filter(prio_land, gid == 211700), fill = "red") +
coord_sf(xlim = c(-170, -140), ylim = c(50, 70), expand = FALSE)
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() +
geom_sf() +
# add the place with no neighbors
geom_sf(data = filter(prio_land, gid == 211700), fill = "red") +
coord_sf(xlim = c(-180, -140), ylim = c(50, 70), expand = FALSE)
# plot place and its neighbors (in canada) # CHECKS OUT!
prio_land %>%
filter(gwno == 20) %>%
ggplot() + geom_sf() +
# random place in canada
geom_sf(data = filter(prio_land, gid == 249328), color = "red") +
# neighbors from nb object
geom_sf(data = filter(prio_land, gid %in% c(249329,249327, 248608)), color = "blue")
# plot place and its neighbors (in canada) # CHECKS OUT!
prio_land %>%
filter(gwno == 20) %>%
ggplot() + geom_sf() +
# random place in canada
geom_sf(data = filter(prio_land, gid == 249328), color = "red") +
# neighbors from nb object
geom_sf(data = filter(prio_land, gid %in% c(249329,249327, 248608)), color = "blue") +
# zoom in on location
coord_sf(xlim = c(-80, -60), ylim = c(80, 100), expand = FALSE)
# plot place and its neighbors (in canada) # CHECKS OUT!
prio_land %>%
filter(gwno == 20) %>%
ggplot() + geom_sf() +
# random place in canada
geom_sf(data = filter(prio_land, gid == 249328), color = "red") +
# neighbors from nb object
geom_sf(data = filter(prio_land, gid %in% c(249329,249327, 248608)), color = "blue") +
# zoom in on location
coord_sf(xlim = c(-80, -60), expand = FALSE)
# plot place and its neighbors (in canada) # CHECKS OUT!
prio_land %>%
filter(gwno == 20) %>%
ggplot() + geom_sf() +
# random place in canada
geom_sf(data = filter(prio_land, gid == 249328), color = "red") +
# neighbors from nb object
geom_sf(data = filter(prio_land, gid %in% c(249329,249327, 248608)), color = "blue") +
# zoom in on location
coord_sf(xlim = c(-80, -60), , ylim = c(80, 90)expand = FALSE)
# plot place and its neighbors (in canada) # CHECKS OUT!
prio_land %>%
filter(gwno == 20) %>%
ggplot() + geom_sf() +
# random place in canada
geom_sf(data = filter(prio_land, gid == 249328), color = "red") +
# neighbors from nb object
geom_sf(data = filter(prio_land, gid %in% c(249329,249327, 248608)), color = "blue") +
# zoom in on location
coord_sf(xlim = c(-80, -60), , ylim = c(80, 90), expand = FALSE)
# plot place and its neighbors (in canada) # CHECKS OUT!
prio_land %>%
filter(gwno == 20) %>%
ggplot() + geom_sf() +
# random place in canada
geom_sf(data = filter(prio_land, gid == 249328), color = "red") +
# neighbors from nb object
geom_sf(data = filter(prio_land, gid %in% c(249329,249327, 248608)), color = "blue") +
# zoom in on location
coord_sf(xlim = c(-80, -60), , ylim = c(80, 90), expand = TRUE)
# plot place and its neighbors (in canada) # CHECKS OUT!
prio_land %>%
filter(gwno == 20) %>%
ggplot() + geom_sf() +
# random place in canada
geom_sf(data = filter(prio_land, gid == 249328), color = "red") +
# neighbors from nb object
geom_sf(data = filter(prio_land, gid %in% c(249329,249327, 248608)), color = "blue") +
# zoom in on location
coord_sf(xlim = c(-80, -60), , ylim = c(80, 90), expand = TRUE)
# plot place and its neighbors (in canada) # CHECKS OUT!
prio_land %>%
filter(gwno == 20) %>%
ggplot() + geom_sf() +
# random place in canada
geom_sf(data = filter(prio_land, gid == 249328), color = "red") +
# neighbors from nb object
geom_sf(data = filter(prio_land, gid %in% c(249329,249327, 248608)), color = "blue")
# plot place and its neighbors (in canada) # CHECKS OUT!
prio_land %>%
filter(gwno == 20) %>%
ggplot() + geom_sf() +
# random place in canada
geom_sf(data = filter(prio_land, gid == 249328), fill = "red") +
# neighbors from nb object
geom_sf(data = filter(prio_land, gid %in% c(249329,249327, 248608)), fill = "blue")
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() +
geom_sf() +
# add the place with no neighbors
geom_sf(data = filter(prio_land, gid == 211700), fill = "red") +
# zoom in on location
coord_sf(xlim = c(-180, -140), ylim = c(50, 70), expand = FALSE)
# plot place and its neighbors (in canada) # CHECKS OUT!
prio_land %>%
filter(gwno == 20) %>%
ggplot() + geom_sf() +
# random place in canada
geom_sf(data = filter(prio_land, gid == 249328), fill = "red") +
# neighbors from nb object
geom_sf(data = filter(prio_land, gid %in% c(249329,249327, 248608)), fill = "blue")
# plot place and its neighbors (in canada) # CHECKS OUT!
prio_land %>%
filter(gwno == 20) %>%
ggplot() + geom_sf() +
# random place in canada
geom_sf(data = filter(prio_land, gid == 249328), fill = "red") +
# neighbors from nb object
geom_sf(data = filter(prio_land, gid %in% c(249329,249327, 248608)), fill = "blue") +
# zoom in on location
coord_sf(xlim = c(-100, -50), ylim = c(60, 90), expand = FALSE)
# plot place and its neighbors (in canada) # CHECKS OUT!
prio_land %>%
filter(gwno == 20) %>%
ggplot() + geom_sf() +
# random place in canada
geom_sf(data = filter(prio_land, gid == 249328), fill = "red") +
# neighbors from nb object
geom_sf(data = filter(prio_land, gid %in% c(249329,249327, 248608)), fill = "blue") +
# zoom in on location
st_crp(xlim = c(-100, -50), ylim = c(60, 90))
# plot place and its neighbors (in canada) # CHECKS OUT!
prio_land %>%
filter(gwno == 20) %>%
ggplot() + geom_sf() +
# random place in canada
geom_sf(data = filter(prio_land, gid == 249328), fill = "red") +
# neighbors from nb object
geom_sf(data = filter(prio_land, gid %in% c(249329,249327, 248608)), fill = "blue") +
# zoom in on location
st_crop(xlim = c(-100, -50), ylim = c(60, 90))
prio_land %>%
filter(gwno == 20) %>%
ggplot() + st_crop(data = ., xlim = c(-100, -50), ylim = c(60, 90))
prio_land %>%
filter(gwno == 20) %>%
ggplot() + st_crop(xlim = c(-100, -50), ylim = c(60, 90))
prio_land %>%
filter(gwno == 20) %>%
ggplot() + st_crop(prio_land, xlim = c(-100, -50), ylim = c(60, 90))
?st_crop
prio_land %>%
filter(gwno == 20) %>%
ggplot() + st_crop(xmin = -100, xmax = -50, ymin = 60, ymax = 90)
st_crop(prio_land, xmin = -100, xmax = -50, ymin = 60, ymax = 90)
ggplot() + st_crop(prio_land, xmin = -100, xmax = -50, ymin = 60, ymax = 90)
ggplot(prio_land) + st_crop(prio_land, xmin = -100, xmax = -50, ymin = 60, ymax = 90)
# plot place and its neighbors (in canada) # CHECKS OUT!
prio_land %>%
filter(gwno == 20) %>%
ggplot() + geom_sf() +
# random place in canada
geom_sf(data = filter(prio_land, gid == 249328), fill = "red") +
# neighbors from nb object
geom_sf(data = filter(prio_land, gid %in% c(249329,249327, 248608)), fill = "blue") +
# zoom in on location
coord_sf(xlim = c(-100, -50), ylim = c(60, 70), expand = FALSE)
# plot place and its neighbors (in canada) # CHECKS OUT!
prio_land %>%
filter(gwno == 20) %>%
ggplot() + geom_sf() +
# random place in canada
geom_sf(data = filter(prio_land, gid == 249328), fill = "red") +
# neighbors from nb object
geom_sf(data = filter(prio_land, gid %in% c(249329,249327, 248608)), fill = "blue") +
# zoom in on location
coord_sf(xlim = c(-100, -50), ylim = c(60, 90), expand = FALSE)
# plot place and its neighbors (in canada) # CHECKS OUT!
prio_land %>%
filter(gwno == 20) %>%
ggplot() + geom_sf() +
# random place in canada
geom_sf(data = filter(prio_land, gid == 249328), fill = "red") +
# neighbors from nb object
geom_sf(data = filter(prio_land, gid %in% c(249329,249327, 248608)), fill = "blue") +
# zoom in on location
coord_sf(xlim = c(-100, -50), ylim = c(75, 85), expand = FALSE)
theme_set(theme_minimal())
# plot place with no neighbors, Alaskan island
prio_land %>%
filter(gwno == 2) %>%
ggplot() +
geom_sf() +
# add the place with no neighbors
geom_sf(data = filter(prio_land, gid == 211700), fill = "red") +
# zoom in on location
coord_sf(xlim = c(-180, -140), ylim = c(50, 70), expand = FALSE)
# plot place and its neighbors (in canada) # CHECKS OUT!
prio_land %>%
filter(gwno == 20) %>%
ggplot() + geom_sf() +
# random place in canada
geom_sf(data = filter(prio_land, gid == 249328), fill = "red") +
# neighbors from nb object
geom_sf(data = filter(prio_land, gid %in% c(249329,249327, 248608)), fill = "blue") +
# zoom in on location
coord_sf(xlim = c(-100, -50), ylim = c(75, 85), expand = FALSE)
blogdown:::serve_site()
getwd()
save(nb, "/Users/JuamnTellez/Dropbox/websites/tellez-site/content/post/prio-grid/nb.rda")
save(nb, file = "/Users/JuamnTellez/Dropbox/websites/tellez-site/content/post/prio-grid/nb.rda")
knitr::opts_chunk$set(echo = TRUE,warning = FALSE,message = FALSE,
fig.width=10, fig.height=10)
load("content/post/prio-grid/nb.rda")
load("/content/post/prio-grid/nb.rda")
getwd()
load("/static/nb.rda")
load("static/nb.rda")
load("/static/nb.rda")
load(file = "/static/nb.rda")
load("/static/nb.rda")
load("static/nb.rda")
load("./static/nb.rda")
load("../static/nb.rda")
load("static/nb.rda")
load("/Users/JuamnTellez/Dropbox/websites/tellez-site/static/nb.rda")
load("../static/nb.rda")
load("../../static/nb.rda")
load("../../../static/nb.rda")
nb
blogdown:::serve_site()
# read data
prio = st_read(dsn = "../../data/priogrid_cellshp",
layer = "priogrid_cell",
stringsAsFactors = F) %>%
mutate(gid = as.character(gid))
# read data
prio = st_read(dsn = "../../../data/priogrid_cellshp",
layer = "priogrid_cell",
stringsAsFactors = F) %>%
mutate(gid = as.character(gid))
# read data
prio = st_read(dsn = "../../../../data/priogrid_cellshp",
layer = "priogrid_cell",
stringsAsFactors = F) %>%
mutate(gid = as.character(gid))
# read data
prio = st_read(dsn = "../../../../../data/priogrid_cellshp",
layer = "priogrid_cell",
stringsAsFactors = F) %>%
mutate(gid = as.character(gid))
# read in PRIO yearly data
prio_year =
# just want gid and gwno to identify water
vroom("../../../../../data/priogrid_cellshp/prio-grid-yearly.csv",
col_select = c("gid", "gwno", "year", "pop_gpw_sum")) %>%
# we got multipe years of data and changing country,
# so i'm arbitrarily picking all countries in most recent year
filter(year == 2005) %>%
mutate(gid = as.character(gid)) %>%
select(-year)
